(()=>{"use strict";function e(e){return rcmail.gettext("AIComposePlugin."+e)}var t,n,o,i,r={elementIndex:-1},l=!1,c=[];function a(){r.elementIndex<c.length-1&&(r.elementIndex++,rcmail.command("addinstructiontemplate",c[r.elementIndex].element.id)),t.classList.toggle("disabled",0===r.elementIndex),n.classList.toggle("disabled",r.elementIndex===c.length-1)}function d(){r.elementIndex>0&&(r.elementIndex--,rcmail.command("addinstructiontemplate",c[r.elementIndex].element.id))}function s(){c.forEach((function(e){e.element.classList.remove("selected","focused")}))}function m(){s(),r.elementIndex=-1}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function p(e,t,n){return(t=function(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=null;function f(){b&&(b.classList.remove("selected"),b.classList.remove("focused"))}function y(e){e.classList.add("selected"),e.classList.add("focused"),b=e}document.addEventListener("DOMContentLoaded",(function(){rcmail.enable_command("addinstructiontemplate",!0),document.querySelector("#responses-table tbody").addEventListener("click",(function(e){"TD"===e.target.tagName&&(f(),y(e.target.parentElement),rcmail.addinstructiontemplate(e.target.parentElement.id))})),document.getElementById("create-button").addEventListener("click",(function(){f()})),document.getElementById("delete-button").addEventListener("click",(function(){var t;document.querySelectorAll("#responses-table tbody tr td").forEach((function(e){e.parentElement.classList.contains("selected")&&(t=e.parentElement.id)})),function(t){var n=e("ai_predefined_popup_body"),o=e("ai_predefined_popup_title"),i=p(p({},e("ai_predefined_delete"),(function(){r.remove(),function(e){rcmail.http_post("plugin.AIComposePlugin_DeleteInstruction",{_id:"".concat(e)},!0).done((function(e){rcmail.show_contentframe(!1),rcmail.enable_command("deleteinstruction",!1)}))}(t)})),e("ai_predefined_cancel"),(function(){r.remove()})),r=rcmail.show_popup_dialog(n,o,i,{width:500,height:45,modal:!0,resizable:!0,button_classes:["mainaction delete btn btn-primary btn-danger","cancel btn btn-secondary"]})}(t)}))})),rcmail.register_command("updateinstructionlist",rcube_webmail.prototype.updateinstructionlist),rcmail.register_command("addinstructiontemplate",rcube_webmail.prototype.addinstructiontemplate),rcmail.register_command("deleteinstruction",rcube_webmail.prototype.deleteinstruction),rcube_webmail.prototype.updateinstructionlist=function(e,t){var n=!1;if(document.querySelectorAll("#responses-table tbody tr td").forEach((function(o){o.parentElement.id===e&&(o.textContent=t,n=!0)})),!n){var o=document.querySelector("#responses-table tbody"),i=document.createElement("tr");i.id=e;var r=document.createElement("td");r.textContent=t,r.className="name",i.append(r),y(i),o.append(i)}},rcube_webmail.prototype.addinstructiontemplate=function(){var e,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u?rcmail.enable_command("deleteinstruction",!0):rcmail.enable_command("deleteinstruction",!1),(e=rcmail.get_frame_window(rcmail.env.contentframe))&&(rcmail.location_href({_action:"plugin.AIComposePlugin_AddInstruction",_id:u,_framed:1},e,!0),function(e){var u=document.querySelector("#layout-content .footer.menu.toolbar.content-frame-navigation.hide-nav-buttons");if(t=u.querySelector(".prev"),n=u.querySelector(".next"),o=document.querySelector("a#create-button-clone.create.button"),i=document.querySelector("a.button.icon.back-list-button"),window.innerWidth<769){var p,b;u.classList.remove("hidden"),l&&(t.removeEventListener("click",d),n.removeEventListener("click",a),null===(b=o)||void 0===b||b.removeEventListener("click",s),i.removeEventListener("click",m));var f=document.querySelector("#responses-table tbody").querySelectorAll("tr");c=Array.from(f).map((function(e,t){return{index:t,element:e}})),r.elementIndex=c.findIndex((function(t){return t.element.id===e})),t.classList.toggle("disabled",0===r.elementIndex),n.classList.toggle("disabled",r.elementIndex===c.length-1),r.elementIndex>=0?(t.style.display="block",n.style.display="block"):(t.style.display="none",n.style.display="none"),t.addEventListener("click",d),n.addEventListener("click",a),null===(p=o)||void 0===p||p.addEventListener("click",s),i.addEventListener("click",m),l=!0}else u.classList.add("hidden")}(u))},rcube_webmail.prototype.deleteinstruction=function(e){var t=document.querySelector("#responses-table tbody"),n=document.getElementById(e);t.contains(n)&&t.removeChild(n)}})();